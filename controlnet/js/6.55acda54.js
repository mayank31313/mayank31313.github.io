(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"170e":function(e,t,n){"use strict";n.d(t,"b",(function(){return b})),n.d(t,"d",(function(){return g})),n.d(t,"c",(function(){return f})),n.d(t,"a",(function(){return u}));var s=n("ded3"),i=n.n(s),o=n("d519"),r=n.n(o),a=n("8972");function c(e,t){this.id=t,this.name=e,Object.defineProperty(this,"rtcPeer",{writable:!0}),Object.defineProperty(this,"remoteVideo",{writable:!0}),this.connectPeer=function(e,t,n){this.remoteVideo=t,this.rtcPeer=r.a.WebRtcPeer.WebRtcPeerSendrecv(e,(function(e){if(e)return console.error(e);n()}))},this.onIceCandidate=function(e){var t={id:"ADD_ICE_CANDIDATE",candidate:e};"Self"!=this.name&&(t["participent"]=this.id),this.sendMessage(t)},this.sendMessage=function(e){var t=JSON.stringify(e);console.log("Sending message: "+t),h.send(t)},this.onOffer=function(e,t){if(e)return console.error("Error generating the offer"+e);console.info("Invoking SDP offer callback function "+location.host);var n={id:"PROCESS_SDP_OFFER",sdpOffer:t};"Self"!=this.name&&(n["participent"]=this.id),u["sendMessage"](n)},this.handleProcessSdpAnswer=function(e){console.log("[handleProcessSdpAnswer] SDP Answer from Kurento, process in WebRTC Peer"),null!=this.rtcPeer?this.rtcPeer.processAnswer(e.sdpAnswer,(e=>{if(e)return console.log(this.name),void console.error(e);console.log(this.name),console.log("[handleProcessSdpAnswer] SDP Answer ready; start remote video"),p(this.remoteVideo)})):console.warn("[handleProcessSdpAnswer] Skip, no WebRTC Peer")},this.dispose=function(){console.log("Disposing participant "+this.name),this.rtcPeer.dispose(),this.rtcPeer=null},this.stop=function(){console.log("[stop]"),this.rtcPeer&&this.dispose(),u["sendMessage"]({id:"STOP"})},this.handleAddIceCandidate=function(e){console.log("Adding ICE Candidate"),null!=this.rtcPeer?this.rtcPeer.addIceCandidate(e.candidate,(e=>{e&&console.error("[handleAddIceCandidate] "+e)})):console.warn("[handleAddIceCandidate] Skip, no WebRTC Peer")}}const d=`ws://${a["d"]}/stream`;var l=null,h=null;const u={};function f(){h=new WebSocket(d),h.onmessage=function(e){const t=JSON.parse(e.data);switch(console.log("[onmessage] Received message: "+e.data),t.id){case"PROCESS_SDP_ANSWER":u["meet__handleSDPOffer"](t);break;case"SESSION":u["sessionId"](t);break;case"ADD_ICE_CANDIDATE":u["meet__onCandidate"](t);break;case"TRANSMITTER_CONNECTED":u["transmitterConnected"](t);break;case"STOP":u["meet__onstop"]();break;case"ERROR":m(t);break;default:u[t.id](t),console.warn("[onmessage] Invalid message, id: "+t.id);break}},h.onopen=function(){console.log("Websocket open"),u["connect_established"]&&u["connect_established"]()}}function p(e){e.play().catch((e=>{"NotAllowedError"===e.name?console.error("[start] Browser doesn't allow playing video: "+e):console.error("[start] Error in video.play(): "+e)}))}function g(){l.stop()}function m(e){const t=e.message;console.error("Kurento error: "+t),console.log("Assume that the other side stops after an error..."),g()}function v(e){var t=JSON.stringify(e);console.log("Sending message: "+t),h.send(t)}function b(e,t,n){console.log("Starting video call ..."),console.log("Creating WebRtcPeer and generating local sdp offer ...");var s={video:{},audio:!0};return l=new c("Self",null),n=i()({remoteVideo:t,onicecandidate:l.onIceCandidate.bind(l),mediaConstraints:s},n),null!=e&&(n=i()(i()({},n),{},{localVideo:e})),l.connectPeer(n,t,(function(){null!=e&&p(e),l.rtcPeer.generateOffer(l.onOffer.bind(l))})),l}u["web_socket"]=function(){return h},u["sendMessage"]=function(e){v(e)},u["connect"]=function(e){v({token:e,id:"CONNECTED"})}},c8c7:function(e,t,n){"use strict";n.r(t);var s=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"q-pa-md"},[n("div",{staticClass:"videoContainer"},[n("div",{staticClass:"row full-width"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"remote-div"},[n("video",{ref:"remoteVideo",staticClass:"remoteVideo"})])])])]),n("q-space")],1)},i=[],o=n("ded3"),r=n.n(o),a=n("0831"),c=n("170e"),d=n("2f62");const{getScrollTarget:l}=a["a"];var h={computed:r()({},Object(d["b"])("stream",["getToken"])),mounted(){if(Object(c["c"])(),c["a"]["meet__onstop"]=this.leaveMeeting,c["a"]["join_request"]=this.joinRequest,c["a"]["meet__addAllowed"]=this.addAllowed,c["a"]["meet__handleSDPOffer"]=this.handleSDPOffer,c["a"]["meet__onCandidate"]=this.onCandidate,c["a"]["connect_established"]=this.connectionEstablished,c["a"]["sessionId"]=this.session,c["a"]["meet__onMessage"]=this.onMessage,c["a"]["START_TRANSMITTER"]=this.startTransmitter,this.$q.cordova){document.addEventListener("deviceready",this.onDeviceReady,!1);var e=this.$q.cordova.plugins.permissions;e.requestPermission(e.CAMERA,(function(e){console.log(e)}),(e=>{console.error(e)})),e.requestPermission(e.RECORD_AUDIO,(function(e){console.log(e)}),(e=>{console.error(e)}))}else this.onDeviceReady()},methods:{session(e){this.sessionId=e.session},startTransmitter(e){navigator.mediaDevices.getUserMedia({video:{deviceId:e.videoInput},audio:!0}).then((e=>{this.self_participent=Object(c["b"])(this.$refs.remoteVideo,null,{videoStream:e}),this.webRtcPeer=this.self_participent.rtcPeer,this.self_participent.id=this.sessionId,this.participentsMap[this.sessionId]=this.self_participent}))},connectionEstablished(){c["a"]["connect"](this.getToken()),navigator.mediaDevices.enumerateDevices().then((e=>{for(var t in e){var n=e[t];"videoinput"==n.kind&&(console.log(n),c["a"]["sendMessage"]({id:"ADD_DEVICE",name:n.label,deviceId:n.deviceId}))}}))},handleSDPOffer(e){this.participentsMap[e.session].handleProcessSdpAnswer(e)},onCandidate(e){this.participentsMap[e.session].handleAddIceCandidate(e)},onDeviceReady(){this.useCustomStream||(this.self_participent=Object(c["b"])(this.$refs.remoteVideo,null,{}),this.webRtcPeer=this.self_participent.rtcPeer)},micClicked(){this.audio=!this.audio,this.webRtcPeer.audioEnabled=this.audio},videoClicked(){this.video=!this.video,this.webRtcPeer.videoEnabled=this.video},leaveMeeting(){Object(c["d"])(),this.$q.notify("Successfully ended Meeting")}},data(){return{requestDialog:!1,position:"top",webRtcPeer:null,audio:!0,video:!0,participentsMap:{},participents:[],self_participent:null,authCode:"",useCustomStream:!0,sessionId:""}},beforeDestroy(){c["a"]["web_socket"]().close(),console.log("DESTROYED")}},u=h,f=n("2877"),p=n("2c91"),g=n("eebe"),m=n.n(g),v=Object(f["a"])(u,s,i,!1,null,null,null);t["default"]=v.exports;m()(v,"components",{QSpace:p["a"]})}}]);