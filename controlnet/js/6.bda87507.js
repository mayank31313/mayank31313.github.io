(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"170e":function(e,t,i){"use strict";i.d(t,"c",(function(){return m})),i.d(t,"f",(function(){return b})),i.d(t,"d",(function(){return u})),i.d(t,"a",(function(){return P})),i.d(t,"e",(function(){return w})),i.d(t,"b",(function(){return g}));var n=i("ded3"),s=i.n(n),o=i("d519"),r=i.n(o),d=(i("8972"),i("cc7d")),c=i("74d1"),a=i.n(c),l=i("2b0e");const u=a.a.over(new d(`${l["a"].prototype.$videoBackend}/stomp`));var p=null;const h="/app/video/";function f(e,t){this.id=t,this.name=e,Object.defineProperty(this,"rtcPeer",{writable:!0}),Object.defineProperty(this,"remoteVideo",{writable:!0}),this.connectPeer=function(e,t,i){this.remoteVideo=t,this.rtcPeer=r.a.WebRtcPeer.WebRtcPeerSendrecv(e,(function(e){if(e)return console.error(e);i()}))},this.onIceCandidate=function(e){g("addIceCandidate",e)},this.sendMessage=function(e,t){g(e,t)},this.onOffer=function(e,t){if(e)return console.error("Error generating the offer"+e);console.info("Invoking SDP offer callback function "+location.host),g("processSdpOffer",{message:t})},this.handleProcessSdpAnswer=function(e){console.log("[handleProcessSdpAnswer] SDP Answer from Kurento, process in WebRTC Peer"),null!=this.rtcPeer?this.rtcPeer.processAnswer(e.sdpAnswer,(e=>{if(e)return console.log(this.name),void console.error(e);console.log(this.name),console.log("[handleProcessSdpAnswer] SDP Answer ready; start remote video"),v(this.remoteVideo)})):console.warn("[handleProcessSdpAnswer] Skip, no WebRTC Peer")},this.dispose=function(){console.log("Disposing participant "+this.name),this.rtcPeer.dispose(),this.rtcPeer=null},this.stop=function(){console.log("[stop]"),this.rtcPeer&&this.dispose()},this.handleAddIceCandidate=function(e){console.log("Adding ICE Candidate"),null!=this.rtcPeer?this.rtcPeer.addIceCandidate(e.candidate,(e=>{e&&console.error("[handleAddIceCandidate] "+e)})):console.warn("[handleAddIceCandidate] Skip, no WebRTC Peer")}}function v(e){e.play().catch((e=>{"NotAllowedError"===e.name?console.error("[start] Browser doesn't allow playing video: "+e):console.error("[start] Error in video.play(): "+e)}))}function b(){p.stop()}function m(e,t,i,n){return console.log("Starting video call ..."),console.log("Creating WebRtcPeer and generating local sdp offer ..."),n=s()({video:{},audio:!1},n),p=new f("Self",null),i=s()({remoteVideo:t,onicecandidate:p.onIceCandidate.bind(p),mediaConstraints:n},i),null!=e&&(i=s()(s()({},i),{},{localVideo:e})),p.connectPeer(i,t,(function(){null!=e&&v(e),p.rtcPeer.generateOffer(p.onOffer.bind(p))})),p}function g(e,t){u.send(h+e,{},JSON.stringify(t))}function P(){navigator.mediaDevices.enumerateDevices().then((e=>{for(var t in e){var i=e[t];"videoinput"==i.kind&&(console.log("DEVICE",i),g("addDevice",{name:i.label,deviceId:i.deviceId}))}}))}function w(e,t){u.connect({Authorization:"Bearer "+e},(e=>{u.subscribe("/user/video/processSdpOffer",(e=>{p.handleProcessSdpAnswer({sdpAnswer:e.body})})),u.subscribe("/user/video/addIceCandidate",(e=>{p.handleAddIceCandidate({candidate:JSON.parse(e.body)})})),u.subscribe("/user/video/stop",(e=>{b()})),t(e)}))}},c8c7:function(e,t,i){"use strict";i.r(t);var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"q-pa-md"},[i("div",{staticClass:"videoContainer"},[i("div",{staticClass:"row full-width"},[i("div",{staticClass:"col-12"},[i("div",{staticClass:"remote-div"},[i("video",{ref:"remoteVideo",staticClass:"remoteVideo"})])])])]),i("q-space")],1)},s=[],o=i("ded3"),r=i.n(o),d=i("0831"),c=i("170e"),a=i("2f62");const{getScrollTarget:l}=d["a"];var u={computed:r()({},Object(a["b"])("stream",["getToken"])),mounted(){Object(c["e"])(this.getToken(),(e=>{c["d"].subscribe("/user/video/config",(e=>{console.log(JSON.parse(e.body))})),c["d"].subscribe("/user/video/startStreaming",(e=>{var t=JSON.parse(e.body);console.log(t),this.startTransmitter(t)})),c["d"].send("/app/video/config"),Object(c["a"])()}))},methods:{session(e){this.sessionId=e.session},startTransmitter(e){navigator.mediaDevices.getUserMedia({video:{deviceId:e.message},audio:!0}).then((e=>{this.self_participent=Object(c["c"])(this.$refs.remoteVideo,null,{videoStream:e},{video:{width:1080,framerate:60},audio:!0}),this.webRtcPeer=this.self_participent.rtcPeer,this.self_participent.id=this.sessionId,this.participentsMap[this.sessionId]=this.self_participent}))},connectionEstablished(){navigator.mediaDevices.enumerateDevices().then((e=>{for(var t in e){var i=e[t];"videoinput"==i.kind&&(console.log("DEVICE",i),Object(c["b"])("addDevice",{name:i.label,deviceId:i.deviceId}))}}))},onDeviceReady(){this.connectionEstablished(),this.useCustomStream||(this.self_participent=Object(c["c"])(this.$refs.remoteVideo,null,{}),this.webRtcPeer=this.self_participent.rtcPeer),Object(c["e"])(this.getToken(),(e=>{c["d"].subscribe("/user/video/config",(e=>{console.log(JSON.parse(e.body))})),c["d"].send("/app/video/config"),this.self_participent=Object(c["c"])(this.$refs.remoteVideo,null,{}),this.webRtcPeer=this.self_participent.rtcPeer,this.self_participent.id=this.sessionId,this.participentsMap[this.sessionId]=this.self_participent}))},micClicked(){this.audio=!this.audio,this.webRtcPeer.audioEnabled=this.audio},videoClicked(){this.video=!this.video,this.webRtcPeer.videoEnabled=this.video}},data(){return{stompClient:null,requestDialog:!1,position:"top",webRtcPeer:null,audio:!0,video:!0,participentsMap:{},participents:[],self_participent:null,authCode:"",useCustomStream:!0,sessionId:""}},beforeDestroy(){console.log("DESTROYED")}},p=u,h=i("2877"),f=i("2c91"),v=i("eebe"),b=i.n(v),m=Object(h["a"])(p,n,s,!1,null,null,null);t["default"]=m.exports;b()(m,"components",{QSpace:f["a"]})}}]);