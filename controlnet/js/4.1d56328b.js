(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"170e":function(e,t,i){"use strict";i.d(t,"b",(function(){return y})),i.d(t,"d",(function(){return m})),i.d(t,"c",(function(){return u})),i.d(t,"a",(function(){return h}));var s=i("ded3"),n=i.n(s),o=i("d519"),a=i.n(o),c=i("8972");function r(e,t){this.id=t,this.name=e,Object.defineProperty(this,"rtcPeer",{writable:!0}),Object.defineProperty(this,"remoteVideo",{writable:!0}),this.connectPeer=function(e,t,i){this.remoteVideo=t,this.rtcPeer=a.a.WebRtcPeer.WebRtcPeerSendrecv(e,(function(e){if(e)return console.error(e);i()}))},this.onIceCandidate=function(e){var t={id:"ADD_ICE_CANDIDATE",candidate:e};"Self"!=this.name&&(t["participent"]=this.id),this.sendMessage(t)},this.sendMessage=function(e){var t=JSON.stringify(e);console.log("Sending message: "+t),p.send(t)},this.onOffer=function(e,t){if(e)return console.error("Error generating the offer"+e);console.info("Invoking SDP offer callback function "+location.host);var i={id:"PROCESS_SDP_OFFER",sdpOffer:t};"Self"!=this.name&&(i["participent"]=this.id),h["sendMessage"](i)},this.handleProcessSdpAnswer=function(e){console.log("[handleProcessSdpAnswer] SDP Answer from Kurento, process in WebRTC Peer"),null!=this.rtcPeer?this.rtcPeer.processAnswer(e.sdpAnswer,(e=>{if(e)return console.log(this.name),void console.error(e);console.log(this.name),console.log("[handleProcessSdpAnswer] SDP Answer ready; start remote video"),g(this.remoteVideo)})):console.warn("[handleProcessSdpAnswer] Skip, no WebRTC Peer")},this.dispose=function(){console.log("Disposing participant "+this.name),this.rtcPeer.dispose(),this.rtcPeer=null},this.stop=function(){console.log("[stop]"),this.rtcPeer&&this.dispose(),h["sendMessage"]({id:"STOP"})},this.handleAddIceCandidate=function(e){console.log("Adding ICE Candidate"),null!=this.rtcPeer?this.rtcPeer.addIceCandidate(e.candidate,(e=>{e&&console.error("[handleAddIceCandidate] "+e)})):console.warn("[handleAddIceCandidate] Skip, no WebRTC Peer")}}const l=`ws://${c["d"]}/stream`;var d=null,p=null;const h={};function u(){p=new WebSocket(l),p.onmessage=function(e){const t=JSON.parse(e.data);switch(console.log("[onmessage] Received message: "+e.data),t.id){case"PROCESS_SDP_ANSWER":h["meet__handleSDPOffer"](t);break;case"SESSION":h["sessionId"](t);break;case"ADD_ICE_CANDIDATE":h["meet__onCandidate"](t);break;case"TRANSMITTER_CONNECTED":h["transmitterConnected"](t);break;case"STOP":h["meet__onstop"]();break;case"ERROR":f(t);break;default:h[t.id](t),console.warn("[onmessage] Invalid message, id: "+t.id);break}},p.onopen=function(){console.log("Websocket open"),h["connect_established"]&&h["connect_established"]()}}function g(e){e.play().catch((e=>{"NotAllowedError"===e.name?console.error("[start] Browser doesn't allow playing video: "+e):console.error("[start] Error in video.play(): "+e)}))}function m(){d.stop()}function f(e){const t=e.message;console.error("Kurento error: "+t),console.log("Assume that the other side stops after an error..."),m()}function v(e){var t=JSON.stringify(e);console.log("Sending message: "+t),p.send(t)}function y(e,t,i){console.log("Starting video call ..."),console.log("Creating WebRtcPeer and generating local sdp offer ...");var s={video:{},audio:!0};return d=new r("Self",null),i=n()({remoteVideo:t,onicecandidate:d.onIceCandidate.bind(d),mediaConstraints:s},i),null!=e&&(i=n()(n()({},i),{},{localVideo:e})),d.connectPeer(i,t,(function(){null!=e&&g(e),d.rtcPeer.generateOffer(d.onOffer.bind(d))})),d}h["web_socket"]=function(){return p},h["sendMessage"]=function(e){v(e)},h["connect"]=function(e){v({token:e,id:"CONNECTED"})}},2003:function(e,t,i){},"86f7":function(e,t,i){"use strict";var s=i("2003"),n=i.n(s);n.a},f724:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-page",[i("div",{staticClass:"q-mt-sm"},[i("div",{staticClass:"q-pa-md q-mr-md row"},[i("div",{staticClass:"col"},[i("q-select",{attrs:{options:e.devices},model:{value:e.droneDevice,callback:function(t){e.droneDevice=t},expression:"droneDevice"}})],1),i("div",{staticClass:"col"},[0==e.missionStatus?i("q-btn",{staticClass:"float-right",attrs:{label:"Upload Mission",color:"positive"},on:{click:e.uploadMission}}):e._e(),1==e.missionStatus?i("q-btn",{staticClass:"float-right",attrs:{label:"Push and Start Mission",color:"accent"},on:{click:e.pushMission}}):e._e(),2==e.missionStatus?i("q-btn",{staticClass:"float-right",attrs:{label:"Terminate Mission",color:"accent"},on:{click:e.startMission}}):e._e()],1)])]),i("div",{staticClass:"row",staticStyle:{"min-height":"400px"}},[i("div",{staticClass:"col-xs-12 col-sm-6 q-pa-sm"},[i("l-map",{staticStyle:{height:"100%"},attrs:{"zoom-controls":!1,zoom:e.zoom,center:e.uavLocation},on:{click:e.boundsUpdated}},[i("l-tile-layer",{attrs:{url:e.url}}),i("l-polyline",{attrs:{"lat-lngs":e.polyline}}),i("v-rotated-marker",{staticStyle:{top:"50%",left:"50%",position:"absolute",border:"2px solid red"},attrs:{"lat-lng":e.uavLocation,icon:e.icon,rotationAngle:e.heading}})],1)],1),i("div",{staticClass:"col-xs-12 bg-black col-sm-6"},[e.render?i("div",[i("video",{ref:"remoteVideo",staticClass:"remoteVideo",staticStyle:{top:"50%",transform:"translateXY(50%, -50%)"}})]):i("div",{staticClass:"flex flex-center",staticStyle:{height:"100%",width:"100%"}},[i("q-spinner-puff",{attrs:{color:"blue-7",size:"4rem"}}),i("div",{staticClass:"text-center text-weight-medium text-blue-6",staticStyle:{width:"100%"}},[e._v("\n                    Video not yet connected\n                ")])],1)])]),i("q-dialog",{attrs:{persistent:""},on:{hide:function(t){e.actionWaypointIndex=-1}},model:{value:e.viewActions,callback:function(t){e.viewActions=t},expression:"viewActions"}},[e.actionWaypointIndex>=0?i("q-card",[i("q-card-section",[i("q-select",{attrs:{options:e.actionTypes,label:"Action Name"},model:{value:e.waypoints[e.actionWaypointIndex].action.actionName,callback:function(t){e.$set(e.waypoints[e.actionWaypointIndex].action,"actionName",t)},expression:"waypoints[actionWaypointIndex].action.actionName"}}),i("q-input",{attrs:{label:"Action Value"},model:{value:e.waypoints[e.actionWaypointIndex].action.actionValue,callback:function(t){e.$set(e.waypoints[e.actionWaypointIndex].action,"actionValue",t)},expression:"waypoints[actionWaypointIndex].action.actionValue"}})],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{label:"cancel",flat:""}})],1)],1):e._e()],1),i("q-list",[i("q-expansion-item",{attrs:{label:"Stats"}},[i("div",{staticClass:"row q-gutter-md justify-center q-pt-md"},e._l(e.stateToProp,(function(t,s){return i("q-card",{key:s,staticClass:"bg-grey-3",staticStyle:{"min-height":"100px","min-width":"200px"}},[i("q-card-section",[i("div",{staticClass:"absolute-top q-ma-sm text-weight-bold"},[e._v("\n                            "+e._s(t.title)+"\n                        ")]),i("div",{staticClass:"text-center q-mt-lg"},[i("span",{staticClass:"text-h4"},[e._v("\n                                "+e._s(t.value)+"\n                            ")]),e._v("\n                            "+e._s(t.unit)+"\n                        ")])])],1)})),1)]),i("q-expansion-item",{attrs:{label:"Waypoints"}},[i("q-card",{attrs:{flat:""}},[i("q-card-section",[i("q-scroll-area",{staticStyle:{height:"200px"}},[i("q-list",{attrs:{separator:"",bordered:""}},[i("q-item",{staticClass:"text-center"},[i("q-item-section",[e._v("#")]),i("q-item-section",[e._v("Lat")]),i("q-item-section",[e._v("Lng")]),i("q-item-section"),i("q-item-section",{staticClass:"q-gutter-sm"})],1),e._l(e.waypoints,(function(t,s){return i("q-item",{key:s},[i("q-item-section",{staticClass:"text-center"},[e._v("\n                                    "+e._s(s)+"\n                                ")]),i("q-item-section",[e._v("\n                                    "+e._s(t.latlng.lat)+"\n                                ")]),i("q-item-section",[e._v("\n                                    "+e._s(t.latlng.lng)+"\n                                ")]),i("q-item-section",[i("q-btn",{attrs:{outline:"",color:"red-6",label:"View Actions"},on:{click:function(t){return e.viewWaypointActions(s)}}})],1),i("q-item-section",[i("q-btn",{attrs:{label:"delete",color:"red-6"},on:{click:function(t){e.waypoints.splice(s,1),e.polyline.splice(s,1)}}})],1)],1)}))],2)],1)],1)],1)],1)],1)],1)},n=[],o=(i("a434"),i("ded3")),a=i.n(o),c=i("170e"),r=i("e11e"),l=i.n(r),d=i("2f62"),p=(i("cc7d"),i("74d1"),i("8972"),{computed:a()(a()({stateToProp(){return[{title:"Altitude",value:33.5,unit:"m"},{title:"Latitude",value:this.uavLocation.lat},{title:"Longitude",value:this.uavLocation.lng},{title:"Armed",value:""},{title:"Heading",value:this.heading}]}},Object(d["b"])("global",["getToken"])),Object(d["d"])("uav",["uavLocation","heading"])),watch:{uavLocation(e){console.log(e),this.waypoints[0].latlng=e,this.polyline[0]=e,this.waypoints.push({}),this.waypoints.splice(this.waypoints.length-1,1),this.polyline.push({}),this.polyline.splice(this.polyline.length-1,1)},waypoints(e){console.log(this.polyline)}},mounted(){Object(c["c"])(),c["a"]["meet__onstop"]=this.leaveMeeting,c["a"]["join_request"]=this.joinRequest,c["a"]["meet__addAllowed"]=this.addAllowed,c["a"]["meet__handleSDPOffer"]=this.handleSDPOffer,c["a"]["meet__onCandidate"]=this.onCandidate,c["a"]["connect_established"]=this.connectionEstablished,c["a"]["sessionId"]=this.session,c["a"]["meet__onMessage"]=this.onMessage,c["a"]["transmitterConnected"]=this.onDeviceReady,this.addWaypoint(this.uavLocation),this.$axios.get(this.$tunnelServer+"/api/drone/getSupportedDevice",{headers:{Authorization:"Bearer "+this.getToken()}}).then((e=>{for(var t in console.log(e),e.data)this.devices.push({label:e.data[t].deviceName,value:e.data[t].id});this.droneDevice=this.devices[0]})),this.$axios.get(this.$backendUrl+"/drone/actionTypes",{headers:{Authorization:"Bearer "+this.getToken()}}).then((e=>{this.actionTypes=e.data})),this.$axios.get(this.$tunnelServer+"/api/drone/mission",{headers:{Authorization:"Bearer "+this.getToken()}}).then((e=>{this.waypoints=e.data.waypoints,this.waypoints.forEach((e=>this.polyline.push(e.latlng)))}))},beforeDestroy(){Object(c["d"])(),c["a"]["web_socket"]().close(),console.log("DESTROYED")},methods:{session(e){this.sessionId=e.session},connectionEstablished(){c["a"]["connect"](this.getToken())},handleSDPOffer(e){this.participentsMap[e.session].handleProcessSdpAnswer(e)},onCandidate(e){this.participentsMap[e.session].handleAddIceCandidate(e)},onDeviceReady(){this.render=!0,setTimeout((()=>{this.self_participent=Object(c["b"])(null,this.$refs.remoteVideo),this.self_participent.id=this.sessionId,this.participentsMap[this.sessionId]=this.self_participent,this.webRtcPeer=this.self_participent.rtcPeer}),1e3)},addWaypoint(e){this.waypoints.push({latlng:e,action:{actionName:"NONE",actionValue:""}}),this.polyline.push(e)},viewWaypointActions(e){console.log(e),this.actionWaypointIndex=e,this.viewActions=!0},boundsUpdated(e){console.log(e),this.addWaypoint(e.latlng)},uploadMission(){this.$axios.post(this.$tunnelServer+"/api/drone/mission",{waypoints:this.waypoints},{headers:{Authorization:"Bearer "+this.getToken()}}).then((e=>{console.log(e),this.$q.notify({type:"positive",message:"Mission Uploaded"}),this.missionStatus=1}))},pushMission(){this.$axios.post(this.$tunnelServer+"/api/drone/push?deviceId="+this.droneDevice.value,{},{headers:{Authorization:"Bearer "+this.getToken()}}).then((e=>{this.$q.notify({type:"positive",message:e.data.message}),this.missionStatus=2})).catch((e=>{console.log(e.response),400==e.response.status?this.$q.notify({type:"negative",message:e.response.data.message}):this.$q.notify({type:"negative",message:"Something Went Wrong"})}))},startMission(){this.$axios.post(this.$tunnelServer+"/api/drone/startMission?deviceId="+this.droneDevice.value,{},{headers:{Authorization:"Bearer "+this.getToken()}}).then((e=>{this.$q.notify({type:"positive",message:"Mission Started"})})).catch((e=>{console.log(e.response),400==e.response.status?this.$q.notify({type:"negative",message:e.response.data.message}):this.$q.notify({type:"negative",message:"Something Went Wrong"})}))}},data(){return{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",waypoints:[],polyline:[],missionStatus:0,stateMatrices:{Altitude:4.6,Latitude:8374},devices:[],actionTypes:[],viewActions:!1,actionWaypointIndex:-1,selectDevice:!0,droneDevice:"",zoom:18,icon:l.a.icon({iconUrl:"/icons/plane-flight-icon.png",iconSize:[32,37],iconAnchor:[16,37]}),render:!1,requestDialog:!1,position:"top",webRtcPeer:null,audio:!0,video:!0,participentsMap:{},participents:[],self_participent:null,sessionId:""}}}),h=p,u=(i("86f7"),i("2877")),g=i("9989"),m=i("ddd8"),f=i("9c40"),v=i("06d5"),y=i("24e8"),b=i("f09f"),w=i("a370"),S=i("27f9"),_=i("4b7e"),q=i("1c1c"),C=i("3b73"),A=i("4983"),P=i("66e5"),x=i("4074"),k=i("7f67"),I=i("eebe"),D=i.n(I),O=Object(u["a"])(h,s,n,!1,null,"81d90428",null);t["default"]=O.exports;D()(O,"components",{QPage:g["a"],QSelect:m["a"],QBtn:f["a"],QSpinnerPuff:v["a"],QDialog:y["a"],QCard:b["a"],QCardSection:w["a"],QInput:S["a"],QCardActions:_["a"],QList:q["a"],QExpansionItem:C["a"],QScrollArea:A["a"],QItem:P["a"],QItemSection:x["a"]}),D()(O,"directives",{ClosePopup:k["a"]})}}]);