(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{1040:function(e,t,n){},"170e":function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"d",(function(){return v})),n.d(t,"c",(function(){return f})),n.d(t,"a",(function(){return h}));var o=n("ded3"),i=n.n(o),s=n("d519"),c=n.n(s),a=n("8972");function r(e,t){this.id=t,this.name=e,Object.defineProperty(this,"rtcPeer",{writable:!0}),Object.defineProperty(this,"remoteVideo",{writable:!0}),this.connectPeer=function(e,t,n){this.remoteVideo=t,this.rtcPeer=c.a.WebRtcPeer.WebRtcPeerSendrecv(e,(function(e){if(e)return console.error(e);n()}))},this.onIceCandidate=function(e){var t={id:"ADD_ICE_CANDIDATE",candidate:e};"Self"!=this.name&&(t["participent"]=this.id),this.sendMessage(t)},this.sendMessage=function(e){var t=JSON.stringify(e);console.log("Sending message: "+t),u.send(t)},this.onOffer=function(e,t){if(e)return console.error("Error generating the offer"+e);console.info("Invoking SDP offer callback function "+location.host);var n={id:"PROCESS_SDP_OFFER",sdpOffer:t};"Self"!=this.name&&(n["participent"]=this.id),h["sendMessage"](n)},this.handleProcessSdpAnswer=function(e){console.log("[handleProcessSdpAnswer] SDP Answer from Kurento, process in WebRTC Peer"),null!=this.rtcPeer?this.rtcPeer.processAnswer(e.sdpAnswer,(e=>{if(e)return console.log(this.name),void console.error(e);console.log(this.name),console.log("[handleProcessSdpAnswer] SDP Answer ready; start remote video"),p(this.remoteVideo)})):console.warn("[handleProcessSdpAnswer] Skip, no WebRTC Peer")},this.dispose=function(){console.log("Disposing participant "+this.name),this.rtcPeer.dispose(),this.rtcPeer=null},this.stop=function(){console.log("[stop]"),this.rtcPeer&&this.dispose(),h["sendMessage"]({id:"STOP"})},this.handleAddIceCandidate=function(e){console.log("Adding ICE Candidate"),null!=this.rtcPeer?this.rtcPeer.addIceCandidate(e.candidate,(e=>{e&&console.error("[handleAddIceCandidate] "+e)})):console.warn("[handleAddIceCandidate] Skip, no WebRTC Peer")}}const d=`ws://${a["d"]}/stream`;var l=null,u=null;const h={};function f(){u=new WebSocket(d),u.onmessage=function(e){const t=JSON.parse(e.data);switch(console.log("[onmessage] Received message: "+e.data),t.id){case"PROCESS_SDP_ANSWER":h["meet__handleSDPOffer"](t);break;case"SESSION":h["sessionId"](t);break;case"ADD_ICE_CANDIDATE":h["meet__onCandidate"](t);break;case"TRANSMITTER_CONNECTED":h["transmitterConnected"](t);break;case"STOP":h["meet__onstop"]();break;case"ERROR":m(t);break;default:h[t.id](t),console.warn("[onmessage] Invalid message, id: "+t.id);break}},u.onopen=function(){console.log("Websocket open"),h["connect_established"]&&h["connect_established"]()}}function p(e){e.play().catch((e=>{"NotAllowedError"===e.name?console.error("[start] Browser doesn't allow playing video: "+e):console.error("[start] Error in video.play(): "+e)}))}function v(){l.stop()}function m(e){const t=e.message;console.error("Kurento error: "+t),console.log("Assume that the other side stops after an error..."),v()}function b(e){var t=JSON.stringify(e);console.log("Sending message: "+t),u.send(t)}function g(e,t,n){console.log("Starting video call ..."),console.log("Creating WebRtcPeer and generating local sdp offer ...");var o={video:{},audio:!0};return l=new r("Self",null),n=i()({remoteVideo:t,onicecandidate:l.onIceCandidate.bind(l),mediaConstraints:o},n),null!=e&&(n=i()(i()({},n),{},{localVideo:e})),l.connectPeer(n,t,(function(){null!=e&&p(e),l.rtcPeer.generateOffer(l.onOffer.bind(l))})),l}h["web_socket"]=function(){return u},h["sendMessage"]=function(e){b(e)},h["connect"]=function(e){b({token:e,id:"CONNECTED"})}},"7a9c":function(e,t,n){"use strict";var o=n("1040"),i=n.n(o);i.a},e23b:function(e,t,n){"use strict";n.r(t);var o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"q-pa-md"},[n("q-dialog",{model:{value:e.selectDeviceModel,callback:function(t){e.selectDeviceModel=t},expression:"selectDeviceModel"}},[n("q-card",{staticClass:"q-pa-md",staticStyle:{"min-width":"350px"}},[n("q-card-section",[n("q-select",{attrs:{options:e.videoDevices},model:{value:e.videoDevice,callback:function(t){e.videoDevice=t},expression:"videoDevice"}})],1),n("q-card-actions",{attrs:{align:"right"}},[n("q-btn",{attrs:{label:"Set Video Source",color:"primary"},on:{click:e.setVideoSource}})],1)],1)],1),e.render?n("div",{staticClass:"videoContainer",on:{load:e.videoLoaded}},[n("div",{staticClass:"row full-width"},[n("div",{staticClass:"col-12"},[n("div",{staticClass:"remote-div"},[n("video",{ref:"remoteVideo",staticClass:"remoteVideo"}),n("div",{staticClass:"local-components center"},[e.audio?n("q-btn",{staticClass:"component-button",attrs:{color:"red",rounded:"",icon:"mic"},on:{click:this.micClicked}}):e._e(),e.audio?e._e():n("q-btn",{staticClass:"component-button",attrs:{color:"red",rounded:"",icon:"mic_off"},on:{click:this.micClicked}}),n("q-btn",{staticClass:"component-button",attrs:{icon:"call_end",color:"red",rounded:""},on:{click:e.leaveMeeting}}),e.video?n("q-btn",{staticClass:"component-button",attrs:{color:"red",rounded:"",icon:"videocam"},on:{click:this.videoClicked}}):e._e(),e.video?e._e():n("q-btn",{staticClass:"component-button",attrs:{color:"red",rounded:"",icon:"videocam_off"},on:{click:this.videoClicked}})],1)])])])]):n("q-card",{attrs:{flat:""}},[n("q-card-section",{staticClass:"text-center q-ma-lg"},[n("q-spinner-tail",{attrs:{color:"primary",size:"10em",thickness:1}})],1),n("q-card-section",{staticClass:"text-center text-h6 q-mt-lg"},[e._v("\n            Please wait while we retrieve live stream\n         ")])],1)],1)},i=[],s=n("ded3"),c=n.n(s),a=n("0831"),r=n("170e"),d=n("2f62");const{getScrollTarget:l}=a["a"];var u={computed:c()(c()({},Object(d["b"])("global",["getToken"])),{},{filteredDevices(){var e=[];for(var t in this.videoDevices)console.warn("Filtered",t),e.push(t);return e}}),mounted(){Object(r["c"])(),r["a"]["meet__onstop"]=this.leaveMeeting,r["a"]["join_request"]=this.joinRequest,r["a"]["meet__addAllowed"]=this.addAllowed,r["a"]["meet__handleSDPOffer"]=this.handleSDPOffer,r["a"]["meet__onCandidate"]=this.onCandidate,r["a"]["connect_established"]=this.connectionEstablished,r["a"]["sessionId"]=this.session,r["a"]["meet__onMessage"]=this.onMessage,r["a"]["transmitterConnected"]=this.transmitterConnected,r["a"]["ADD_DEVICE"]=e=>{console.warn(e),this.videoDevices.push({label:e.name,value:e.deviceId})}},methods:{setVideoSource(){r["a"]["sendMessage"]({id:"START_STREAMING",videoInput:this.videoDevice.value})},videoLoaded(){console.log("Loaded")},transmitterConnected(){if(this.$q.cordova){document.addEventListener("deviceready",this.onDeviceReady,!1);var e=this.$q.cordova.plugins.permissions;e.requestPermission(e.CAMERA,(function(e){console.log(e)}),(e=>{console.error(e)})),e.requestPermission(e.RECORD_AUDIO,(function(e){console.log(e)}),(e=>{console.error(e)}))}else this.onDeviceReady()},session(e){this.sessionId=e.session},connectionEstablished(){r["a"]["connect"](this.getToken())},handleSDPOffer(e){this.participentsMap[e.session].handleProcessSdpAnswer(e)},onCandidate(e){this.participentsMap[e.session].handleAddIceCandidate(e)},onDeviceReady(){this.selectDeviceModel=!1,this.render=!0,setTimeout((()=>{this.self_participent=Object(r["b"])(null,this.$refs.remoteVideo),this.self_participent.id=this.sessionId,this.participentsMap[this.sessionId]=this.self_participent,this.webRtcPeer=this.self_participent.rtcPeer}),1e3)},micClicked(){this.audio=!this.audio,this.webRtcPeer.audioEnabled=this.audio},videoClicked(){this.video=!this.video,this.webRtcPeer.videoEnabled=this.video},leaveMeeting(){Object(r["d"])(),this.$q.notify("Successfully ended Connection")}},data(){return{render:!1,requestDialog:!1,position:"top",webRtcPeer:null,audio:!0,video:!0,participentsMap:{},participents:[],self_participent:null,sessionId:"",videoDevices:[],videoDevice:"",selectDeviceModel:!0}},beforeDestroy(){Object(r["d"])(),r["a"]["web_socket"]().close(),console.log("DESTROYED")}},h=u,f=(n("7a9c"),n("2877")),p=n("24e8"),v=n("f09f"),m=n("a370"),b=n("ddd8"),g=n("4b7e"),C=n("9c40"),S=n("007d"),_=n("eebe"),D=n.n(_),P=Object(f["a"])(h,o,i,!1,null,null,null);t["default"]=P.exports;D()(P,"components",{QDialog:p["a"],QCard:v["a"],QCardSection:m["a"],QSelect:b["a"],QCardActions:g["a"],QBtn:C["a"],QSpinnerTail:S["a"]})}}]);