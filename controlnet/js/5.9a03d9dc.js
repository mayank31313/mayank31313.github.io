(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{1040:function(e,t,i){},"170e":function(e,t,i){"use strict";i.d(t,"c",(function(){return m})),i.d(t,"f",(function(){return b})),i.d(t,"d",(function(){return u})),i.d(t,"a",(function(){return C})),i.d(t,"e",(function(){return w})),i.d(t,"b",(function(){return g}));var o=i("ded3"),n=i.n(o),s=i("d519"),c=i.n(s),r=(i("8972"),i("cc7d")),d=i("74d1"),a=i.n(d),l=i("2b0e");const u=a.a.over(new r(`${l["a"].prototype.$videoBackend}/stomp`));var v=null;const p="/app/video/";function f(e,t){this.id=t,this.name=e,Object.defineProperty(this,"rtcPeer",{writable:!0}),Object.defineProperty(this,"remoteVideo",{writable:!0}),this.connectPeer=function(e,t,i){this.remoteVideo=t,this.rtcPeer=c.a.WebRtcPeer.WebRtcPeerSendrecv(e,(function(e){if(e)return console.error(e);i()}))},this.onIceCandidate=function(e){g("addIceCandidate",e)},this.sendMessage=function(e,t){g(e,t)},this.onOffer=function(e,t){if(e)return console.error("Error generating the offer"+e);console.info("Invoking SDP offer callback function "+location.host),g("processSdpOffer",{message:t})},this.handleProcessSdpAnswer=function(e){console.log("[handleProcessSdpAnswer] SDP Answer from Kurento, process in WebRTC Peer"),null!=this.rtcPeer?this.rtcPeer.processAnswer(e.sdpAnswer,(e=>{if(e)return console.log(this.name),void console.error(e);console.log(this.name),console.log("[handleProcessSdpAnswer] SDP Answer ready; start remote video"),h(this.remoteVideo)})):console.warn("[handleProcessSdpAnswer] Skip, no WebRTC Peer")},this.dispose=function(){console.log("Disposing participant "+this.name),this.rtcPeer.dispose(),this.rtcPeer=null},this.stop=function(){console.log("[stop]"),this.rtcPeer&&this.dispose()},this.handleAddIceCandidate=function(e){console.log("Adding ICE Candidate"),null!=this.rtcPeer?this.rtcPeer.addIceCandidate(e.candidate,(e=>{e&&console.error("[handleAddIceCandidate] "+e)})):console.warn("[handleAddIceCandidate] Skip, no WebRTC Peer")}}function h(e){e.play().catch((e=>{"NotAllowedError"===e.name?console.error("[start] Browser doesn't allow playing video: "+e):console.error("[start] Error in video.play(): "+e)}))}function b(){v.stop()}function m(e,t,i,o){return console.log("Starting video call ..."),console.log("Creating WebRtcPeer and generating local sdp offer ..."),o=n()({video:{},audio:!1},o),v=new f("Self",null),i=n()({remoteVideo:t,onicecandidate:v.onIceCandidate.bind(v),mediaConstraints:o},i),null!=e&&(i=n()(n()({},i),{},{localVideo:e})),v.connectPeer(i,t,(function(){null!=e&&h(e),v.rtcPeer.generateOffer(v.onOffer.bind(v))})),v}function g(e,t){u.send(p+e,{},JSON.stringify(t))}function C(){navigator.mediaDevices.enumerateDevices().then((e=>{for(var t in e){var i=e[t];"videoinput"==i.kind&&(console.log("DEVICE",i),g("addDevice",{name:i.label,deviceId:i.deviceId}))}}))}function w(e,t){u.connect({Authorization:"Bearer "+e},(e=>{u.subscribe("/user/video/processSdpOffer",(e=>{v.handleProcessSdpAnswer({sdpAnswer:e.body})})),u.subscribe("/user/video/addIceCandidate",(e=>{v.handleAddIceCandidate({candidate:JSON.parse(e.body)})})),u.subscribe("/user/video/stop",(e=>{b()})),t(e)}))}},"7a9c":function(e,t,i){"use strict";i("1040")},e23b:function(e,t,i){"use strict";i.r(t);var o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"q-pa-md"},[i("q-dialog",{model:{value:e.selectDeviceModel,callback:function(t){e.selectDeviceModel=t},expression:"selectDeviceModel"}},[i("q-card",{staticClass:"q-pa-md",staticStyle:{"min-width":"350px"}},[i("q-card-section",[i("q-select",{attrs:{options:e.videoDevices},model:{value:e.videoDevice,callback:function(t){e.videoDevice=t},expression:"videoDevice"}})],1),i("q-card-actions",{attrs:{align:"right"}},[i("q-btn",{attrs:{label:"Set Video Source",color:"primary"},on:{click:e.setVideoSource}})],1)],1)],1),e.render?i("div",{staticClass:"videoContainer",on:{load:e.videoLoaded}},[i("div",{staticClass:"row full-width"},[i("div",{staticClass:"col-12"},[i("div",{staticClass:"remote-div"},[i("video",{ref:"remoteVideo",staticClass:"remoteVideo"}),i("div",{staticClass:"local-components center"},[i("q-btn",{staticClass:"component-button",attrs:{color:"red",rounded:"",icon:e.audio?"mic":"mic_off"},on:{click:e.micClicked}}),i("q-btn",{staticClass:"component-button",attrs:{icon:"call_end",color:"red",rounded:""},on:{click:e.leaveMeeting}}),i("q-btn",{staticClass:"component-button",attrs:{color:"red",rounded:"",icon:e.video?"videocam":"videocam_off"},on:{click:e.videoClicked}})],1)])])])]):i("q-card",{attrs:{flat:""}},[i("q-card-section",{staticClass:"text-center q-ma-lg"},[i("q-spinner-tail",{attrs:{color:"primary",size:"10em",thickness:1}})],1),i("q-card-section",{staticClass:"text-center text-h6 q-mt-lg"},[e._v("\n            Please wait while we retrieve live stream\n         ")])],1)],1)},n=[],s=i("ded3"),c=i.n(s),r=i("0831"),d=i("170e"),a=i("2f62");const{getScrollTarget:l}=r["a"];var u={computed:c()({},Object(a["b"])("global",["getToken"])),watch:{videoDevices(e){console.log("WATCH",e)}},data(){return{render:!1,requestDialog:!1,position:"top",webRtcPeer:null,audio:!0,video:!0,participentsMap:{},participents:[],self_participent:null,sessionId:"",videoDevices:[],videoDevice:"",selectDeviceModel:!0}},mounted(){Object(d["e"])(this.getToken(),(e=>{d["d"].subscribe("/user/video/config",(e=>{console.log(JSON.parse(e.body))})),d["d"].subscribe("/user/video/transmitterConnected",(e=>{this.transmitterConnected()})),d["d"].subscribe("/user/video/addDevice",(e=>{var t=JSON.parse(e.body);this.videoDevices.push({label:t.name,value:t.deviceId})})),Object(d["b"])("config/getDevice",{}),d["d"].send("/app/video/config")}))},methods:{setVideoSource(){Object(d["b"])("startStreaming",{message:this.videoDevice.value})},videoLoaded(){console.log("Loaded")},transmitterConnected(){this.selectDeviceModel=!1,this.render=!0,setTimeout((()=>{this.self_participent=Object(d["c"])(null,this.$refs.remoteVideo,{},{video:{width:480,framerate:10},audio:!0}),this.self_participent.id=this.sessionId,this.participentsMap[this.sessionId]=this.self_participent,this.webRtcPeer=this.self_participent.rtcPeer}),1e3)},session(e){this.sessionId=e.session},micClicked(){this.audio=!this.audio,this.webRtcPeer.audioEnabled=this.audio},videoClicked(){this.video=!this.video,this.webRtcPeer.videoEnabled=this.video},leaveMeeting(){Object(d["b"])("stop",{}),Object(d["f"])(),this.$q.notify("Successfully ended Connection")}},beforeDestroy(){Object(d["b"])("stop",{}),Object(d["f"])(),console.log("DESTROYED")}},v=u,p=(i("7a9c"),i("2877")),f=i("24e8"),h=i("f09f"),b=i("a370"),m=i("ddd8"),g=i("4b7e"),C=i("9c40"),w=i("007d"),P=i("eebe"),S=i.n(P),D=Object(p["a"])(v,o,n,!1,null,null,null);t["default"]=D.exports;S()(D,"components",{QDialog:f["a"],QCard:h["a"],QCardSection:b["a"],QSelect:m["a"],QCardActions:g["a"],QBtn:C["a"],QSpinnerTail:w["a"]})}}]);